<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Orders (ADMIN)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:Arial;background:#f7f7f7}
.container{width:95%;max-width:1000px;margin:20px auto}
.order{background:#fff;padding:20px;border-radius:10px;margin-bottom:25px}
button{padding:8px 15px;margin-top:10px;border:none;cursor:pointer}
.logout{background:red;color:white}
.print{background:#007bff;color:white}

/* INVOICE STYLE */
.invoice{
    border:1px solid #ccc;
    padding:20px;
    margin-top:15px
}
.invoice-header{
    display:flex;
    align-items:center;
    border-bottom:2px solid #000;
    padding-bottom:10px;
    margin-bottom:15px
}
.invoice-header img{
    width:80px;
    margin-right:15px
}
.company-details h2{
    margin:0;
    font-size:22px
}
.company-details p{
    margin:2px 0;
    font-size:14px
}
.invoice-info{
    margin-bottom:15px
}
.invoice-info p{margin:4px 0}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px
}
table th, table td{
    border:1px solid #999;
    padding:8px;
    text-align:left;
    font-size:14px
}
table th{background:#f0f0f0}

.total{
    text-align:right;
    font-size:18px;
    margin-top:10px;
    font-weight:bold
}
.remove{
    background:#dc3545;
    color:white;
    margin-left:10px
}

</style>
</head>

<body>

<div class="container">
<h2>üì¶ Orders (Admin)</h2>
<button class="logout" onclick="logout()">Logout</button>

<div id="ordersBox"></div>
</div>

<script>
if(localStorage.getItem("adminLogged") !== "true"){
    window.location.href = "admin-login.html";
}

let orders = JSON.parse(localStorage.getItem("orders")) || [];
let box = document.getElementById("ordersBox");

function renderOrders(){
    box.innerHTML = "";

    if(orders.length === 0){
        box.innerHTML = "<p>No orders found</p>";
        return;
    }

    orders.forEach((order, index)=>{
        let rows = "";
        order.items.forEach((item,i)=>{
            rows += `
            <tr>
                <td>${i+1}</td>
                <td>${item.name}</td>
                <td>${item.code}</td>
                <td>${item.color}</td>
                <td>${item.qty}</td>
                <td>Rs.${item.price}</td>
                <td>Rs.${item.price * item.qty}</td>
            </tr>`;
        });

        box.innerHTML += `
        <div class="order">
            <div class="invoice" id="invoice-${index}">
                <div class="invoice-header">
                    <img src="logo.jpg">
                    <div class="company-details">
                        <h2>LNKW Steel Works</h2>
                        <p>No 352/1B, Horana-Colombo Road, Kahathuduwa, Polgasowita.</p>
                        <p>üìû 076 222 6839</p>
                    </div>
                </div>

                <div class="invoice-info">
                    <p><b>Invoice No:</b> LNKW-${1000 + index}</p>
                    <p><b>Date:</b> ${order.date}</p>
                    <p><b>Customer:</b> ${order.customer}</p>
                    <p><b>Phone:</b> ${order.phone}</p>
                </div>

                <table>
                    <tr>
                        <th>#</th>
                        <th>Product</th>
                        <th>Code</th>
                        <th>Colour</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Total</th>
                    </tr>
                    ${rows}
                </table>

                <div class="total">
                    Grand Total: Rs.${order.total}
                </div>
            </div>

            <button class="print" onclick="printInvoice(${index})">üñ® Print Invoice</button>
            <button class="remove" onclick="removeOrder(${index})">‚ùå Remove Order</button>
        </div>`;
    });
}

renderOrders();


// PRINT
function printInvoice(i){
    let invoice = document.getElementById("invoice-"+i).outerHTML;

    let w = window.open("", "", "width=800,height=600");
    w.document.write(`
        <html>
        <head>
            <title>Invoice</title>
            <style>
                body{font-family:Arial;padding:20px}
                .invoice{
                    border:1px solid #ccc;
                    padding:20px
                }
                .invoice-header{
                    display:flex;
                    align-items:center;
                    border-bottom:2px solid #000;
                    padding-bottom:10px;
                    margin-bottom:15px
                }
                .invoice-header img{
                    width:80px;
                    margin-right:15px
                }
                table{
                    width:100%;
                    border-collapse:collapse;
                    margin-top:10px
                }
                th,td{
                    border:1px solid #999;
                    padding:8px;
                    font-size:14px
                }
                th{background:#f0f0f0}
                .total{
                    text-align:right;
                    font-size:18px;
                    font-weight:bold;
                    margin-top:10px
                }
            </style>
        </head>
        <body>
            ${invoice}
        </body>
        </html>
    `);
    w.document.close();
    w.print();
}

function removeOrder(index){
    if(confirm("Are you sure you want to delete this order?")){
        orders.splice(index, 1);
        localStorage.setItem("orders", JSON.stringify(orders));
        renderOrders();   // üî• NO RELOAD
    }
}



// LOGOUT
function logout(){
    localStorage.removeItem("adminLogged");
    window.location.href = "admin-login.html";
}
</script>

</body>
</html>
